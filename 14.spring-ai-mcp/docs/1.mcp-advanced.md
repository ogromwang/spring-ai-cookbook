# MCP è¿›é˜¶ä½¿ç”¨

æœ¬æ–‡æ¡£å°†æ·±å…¥è®²è§£ MCP çš„é«˜çº§åŠŸèƒ½å’Œä½¿ç”¨æŠ€å·§ï¼Œå¸®åŠ©æ‚¨å……åˆ†åˆ©ç”¨ MCP çš„å¼ºå¤§èƒ½åŠ›ã€‚

- [Model Context Protocol å®˜æ–¹æ–‡æ¡£](https://modelcontextprotocol.io/docs/getting-started/intro) - MCP å®˜æ–¹å…¥é—¨æŒ‡å—
- [Anthropic å®˜æ–¹å‘å¸ƒ](https://www.anthropic.com/news/model-context-protocol) - MCP å®˜æ–¹æ–°é—»å‘å¸ƒ
- [Cloudflare æŠ€æœ¯è§£è¯»](https://www.cloudflare.com/zh-cn/learning/ai/what-is-model-context-protocol-mcp/) - MCP æ˜¯ä»€ä¹ˆ?
- [Agent Network Protocol å¯¹æ¯”](https://agent-network-protocol.com/zh/blogs/posts/mcp-10-questions.html) - MCP åé—®åç­”
- [Cursor MCP é›†æˆ](https://cursor.com/cn/docs/context/mcp) - Cursor ç¼–è¾‘å™¨ MCP ä½¿ç”¨æ–‡æ¡£
- [MCP ä¸­æ–‡ç½‘](https://mcpcn.com/) - MCP ä¸­æ–‡ç¤¾åŒºé—¨æˆ·

## 1. Toolsï¼ˆå·¥å…·ï¼‰

Tools æ˜¯ MCP æœåŠ¡å™¨æš´éœ²ç»™å®¢æˆ·ç«¯å’Œ LLM çš„å¯æ‰§è¡ŒåŠŸèƒ½ã€‚é€šè¿‡ Toolsï¼ŒLLM å¯ä»¥è°ƒç”¨å¤–éƒ¨ç³»ç»Ÿæ¥å®Œæˆå„ç§ä»»åŠ¡ã€‚

### 1.1 å·¥å…·æä¾›å™¨ï¼ˆToolCallbackProviderï¼‰

Spring AI MCP æä¾›äº†å¤šç§å·¥å…·æä¾›å™¨æ¥æ³¨å†Œå·¥å…·ï¼š

#### MethodToolCallbackProvider

æœ€å¸¸ç”¨çš„å·¥å…·æä¾›å™¨ï¼Œé€šè¿‡ `@Tool` æ³¨è§£è‡ªåŠ¨è¯†åˆ«æ–¹æ³•å¹¶æ³¨å†Œä¸ºå·¥å…·ï¼š

```java
@Configuration
public class McpServerAutoConfiguration {
    
    @Bean
    public ToolCallbackProvider weatherTools(WeatherService weatherService) {
        return MethodToolCallbackProvider.builder()
                .toolObjects(weatherService)
                .build();
    }
}
```

#### StaticToolCallbackProvider

ç”¨äºæ³¨å†Œé™æ€å‡½æ•°å·¥å…·ï¼Œå†…éƒ¨ä½¿ç”¨ `FunctionCallback` è¿›è¡ŒåŒ…è£…ï¼š

```java
@Bean
public ToolCallbackProvider staticTools() {
    return StaticToolCallbackProvider.builder()
            .functions(List.of(
                new FunctionCallback("calculate", "è®¡ç®—å™¨", 
                    (input) -> "è®¡ç®—ç»“æœ: " + input)
            ))
            .build();
}
```

#### SyncMcpToolCallbackProvider / AsyncMcpToolCallbackProvider

ç”¨äºåŒæ­¥å’Œå¼‚æ­¥çš„ MCP å·¥å…·å›è°ƒï¼š

```java
@Bean
public ToolCallbackProvider syncMcpTools() {
    return SyncMcpToolCallbackProvider.builder()
            .toolSpecifications(List.of(
                new McpSchema.Tool("syncTool", "åŒæ­¥å·¥å…·", null, null)
            ))
            .toolHandler((exchange, request) -> {
                // å¤„ç†å·¥å…·è°ƒç”¨
                return new McpSchema.CallToolResult(
                    List.of(new McpSchema.TextContent("æ‰§è¡Œç»“æœ"))
                );
            })
            .build();
}
```

### 1.2 å·¥å…·å›è°ƒï¼ˆToolCallbackï¼‰

æ‰€æœ‰å·¥å…·æä¾›å™¨æœ€ç»ˆéƒ½ä¼šæ„å»º `ToolCallback` æ¥å£ç±»å‹çš„å®ä¾‹ï¼š

- **MethodToolCallback**ï¼šæ™®é€š `@Tool` æ ‡è¯†çš„æ–¹æ³•å·¥å…·å›è°ƒ
- **FunctionToolCallback**ï¼šå‡½æ•°å›è°ƒå·¥å…·
- **SyncMcpToolCallback / AsyncMcpToolCallback**ï¼šåŒæ­¥/å¼‚æ­¥å·¥å…·å›è°ƒ

### 1.3 ä½¿ç”¨ ToolContext

åœ¨å·¥å…·æ–¹æ³•ä¸­ï¼Œå¯ä»¥é€šè¿‡ `ToolContext` å‚æ•°è®¿é—® MCP çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼š

```java
@Service
public class WeatherService {
    
    @Tool(description = "å¤©æ°”æŸ¥è¯¢")
    public String queryWeather(String city, ToolContext toolContext) {
        // é€šè¿‡ ToolContext è®¿é—® MCP Exchange
        McpToolUtils.getMcpExchange(toolContext)
            .ifPresent(exchange -> {
                // å¯ä»¥è®¿é—®å®¢æˆ·ç«¯èƒ½åŠ›ã€è°ƒç”¨å…¶ä»–èµ„æºç­‰
                System.out.println("å®¢æˆ·ç«¯èƒ½åŠ›: " + exchange.getClientCapabilities());
            });
        
        return city + "çš„å¤©æ°”æ˜¯18Â°";
    }
}
```

## 2. Resourcesï¼ˆèµ„æºï¼‰

Resources æ˜¯æœåŠ¡å™¨æš´éœ²çš„æ•°æ®å’Œå†…å®¹ï¼Œä¾›å®¢æˆ·ç«¯è¯»å–å¹¶ä½œä¸º LLM ä¸Šä¸‹æ–‡ã€‚å¯ä»¥ç†è§£ä¸ºç±»ä¼¼ Spring MVC çš„æ¥å£ï¼Œç”¨äºæŸ¥è¯¢æ•°æ®ã€‚

### 2.1 å®šä¹‰èµ„æº

```java
@Bean
public List<McpServerFeatures.SyncResourceSpecification> resource() {
    // å®šä¹‰èµ„æºæ³¨è§£ï¼ˆå¯é€‰ï¼‰
    McpSchema.Annotations annotations = 
        new McpSchema.Annotations(List.of(McpSchema.Role.USER), 0.1);
    
    // åˆ›å»ºèµ„æºå®šä¹‰
    var databaseResource = new McpSchema.Resource(
        "/v1/api/query",           // URI
        "queryDatabase",           // åç§°
        "æ•°æ®åº“æŸ¥è¯¢",              // æè¿°
        "",                        // MIME ç±»å‹
        annotations                // æ³¨è§£
    );
    
    // å®šä¹‰èµ„æºå¤„ç†å™¨
    var resourceSpecification = 
        new McpServerFeatures.SyncResourceSpecification(
            databaseResource,
            (exchange, request) -> {
                try {
                    // æŸ¥è¯¢æ•°æ®
                    var data = Map.of("order", "è®¢å•ä¿¡æ¯");
                    String jsonContent = new ObjectMapper()
                        .writeValueAsString(data);
                    
                    // è¿”å›èµ„æºå†…å®¹
                    return new McpSchema.ReadResourceResult(
                        List.of(new McpSchema.TextResourceContents(
                            request.uri(), 
                            "application/json", 
                            jsonContent
                        ))
                    );
                } catch (Exception e) {
                    throw new RuntimeException("æŸ¥è¯¢å¤±è´¥", e);
                }
            }
        );
    
    return List.of(resourceSpecification);
}
```

### 2.2 å®¢æˆ·ç«¯è¯»å–èµ„æº

```java
@Bean
public CommandLineRunner readResources(List<McpSyncClient> mcpSyncClients) {
    return args -> {
        mcpSyncClients.forEach(mcpSyncClient -> {
            // åˆ—å‡ºæ‰€æœ‰å¯ç”¨èµ„æº
            List<String> resources = mcpSyncClient.listResources()
                .resources()
                .stream()
                .map(McpSchema.Resource::name)
                .toList();
            System.out.println("å¯ç”¨èµ„æº: " + resources);
            
            // è¯»å–ç‰¹å®šèµ„æº
            McpSchema.ReadResourceRequest request = 
                new McpSchema.ReadResourceRequest("/v1/api/query");
            McpSchema.ReadResourceResult result = 
                mcpSyncClient.readResource(request);
            
            result.contents().forEach(content -> {
                if (content instanceof McpSchema.TextResourceContents textContent) {
                    System.out.println("èµ„æºå†…å®¹: " + textContent.text());
                }
            });
        });
    };
}
```

## 3. Promptsï¼ˆæç¤ºè¯ï¼‰

Prompts å…è®¸æœåŠ¡å™¨å®šä¹‰å¯å¤ç”¨çš„æç¤ºæ¨¡æ¿ï¼Œå¼•å¯¼ LLM äº¤äº’ã€‚è¿™å¯¹äºæ ‡å‡†åŒ–æç¤ºè¯ã€æé«˜å¤ç”¨æ€§éå¸¸æœ‰ç”¨ã€‚

### 3.1 å®šä¹‰æç¤ºè¯

```java
@Bean
public List<McpServerFeatures.SyncPromptSpecification> prompts() {
    // åˆ›å»ºæç¤ºè¯å®šä¹‰ï¼ŒåŒ…å«å‚æ•°
    var prompt = new McpSchema.Prompt(
        "greeting",                                    // æç¤ºè¯åç§°
        "ä¸€ä¸ªå‹å¥½çš„æç¤ºè¯æ¨¡æ¿",                        // æè¿°
        List.of(new McpSchema.PromptArgument(         // å‚æ•°åˆ—è¡¨
            "name",                                    // å‚æ•°å
            "åç§°",                                    // å‚æ•°æè¿°
            true                                       // æ˜¯å¦å¿…éœ€
        ))
    );
    
    // å®šä¹‰æç¤ºè¯å¤„ç†å™¨
    var promptSpecification = 
        new McpServerFeatures.SyncPromptSpecification(
            prompt,
            (exchange, getPromptRequest) -> {
                // è·å–å‚æ•°
                String nameArgument = (String) 
                    getPromptRequest.arguments().get("name");
                if (nameArgument == null) {
                    nameArgument = "æœ‹å‹";
                }
                
                // æ„å»ºæç¤ºè¯æ¶ˆæ¯
                var userMessage = new McpSchema.PromptMessage(
                    McpSchema.Role.USER,
                    new McpSchema.TextContent(
                        "ä½ å¥½ " + nameArgument + "! æˆ‘å¯ä»¥å¸®åŠ©ä½ ä»€ä¹ˆ?"
                    )
                );
                
                return new McpSchema.GetPromptResult(
                    "ä¸ªæ€§åŒ–é—®å€™è¯­", 
                    List.of(userMessage)
                );
            }
        );
    
    return List.of(promptSpecification);
}
```

### 3.2 å®¢æˆ·ç«¯è·å–æç¤ºè¯

```java
@Bean
public CommandLineRunner getPrompts(List<McpSyncClient> mcpSyncClients) {
    return args -> {
        mcpSyncClients.forEach(mcpSyncClient -> {
            // åˆ—å‡ºæ‰€æœ‰æç¤ºè¯
            List<String> prompts = mcpSyncClient.listPrompts()
                .prompts()
                .stream()
                .map(McpSchema.Prompt::name)
                .toList();
            System.out.println("å¯ç”¨æç¤ºè¯: " + prompts);
            
            // è·å–ç‰¹å®šæç¤ºè¯
            McpSchema.GetPromptRequest request = 
                new McpSchema.GetPromptRequest(
                    "greeting", 
                    Map.of("name", "å¼ ä¸‰")
                );
            McpSchema.GetPromptResult result = 
                mcpSyncClient.getPrompt(request);
            
            System.out.println("æç¤ºè¯æè¿°: " + result.description());
            result.messages().forEach(message -> {
                System.out.println("æ¶ˆæ¯: " + message.content());
            });
        });
    };
}
```

## 4. Rootsï¼ˆæ ¹èµ„æºï¼‰

Roots å…è®¸å®¢æˆ·ç«¯å‘Šè¯‰æœåŠ¡å™¨åº”è¯¥å…³æ³¨å“ªäº›èµ„æºèŒƒå›´ã€‚å½“å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨æ—¶ï¼Œä¼šå£°æ˜åº”è¯¥å…³æ³¨å“ªäº›æ ¹èµ„æºã€‚æ ¹èµ„æºå¯ä»¥æ˜¯æ–‡ä»¶è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯ HTTP URL åœ°å€ã€‚

### 4.1 å®¢æˆ·ç«¯é…ç½® Roots

é¦–å…ˆéœ€è¦åœ¨å®¢æˆ·ç«¯å¯ç”¨ Roots èƒ½åŠ›ï¼š

```java
@Component
public static class CustomMcpSyncClientCustomizer 
        implements McpSyncClientCustomizer {
    
    @Override
    public void customize(String serverConfigurationName, 
                          McpClient.SyncSpec spec) {
        
        // å¯ç”¨ Roots èƒ½åŠ›
        McpSchema.ClientCapabilities clientCapabilities = 
            McpSchema.ClientCapabilities.builder()
                .experimental(Map.of())
                .roots(true)  // å¯ç”¨ Roots
                .sampling()
                .build();
        spec.capabilities(clientCapabilities);
    }
}
```

### 4.2 æ·»åŠ æ ¹èµ„æº

```java
@Bean
public CommandLineRunner addRoots(List<McpSyncClient> mcpSyncClients) {
    return args -> {
        mcpSyncClients.forEach(mcpSyncClient -> {
            // æ·»åŠ æ–‡ä»¶ç³»ç»Ÿæ ¹èµ„æº
            McpSchema.Root fileRoot = 
                new McpSchema.Root("file:///home/user/projects", "é¡¹ç›®ç›®å½•");
            mcpSyncClient.addRoot(fileRoot);
            
            // æ·»åŠ  HTTP æ ¹èµ„æº
            McpSchema.Root httpRoot = 
                new McpSchema.Root("https://api.example.com/v1", "APIç«¯ç‚¹");
            mcpSyncClient.addRoot(httpRoot);
        });
    };
}
```

### 4.3 æœåŠ¡ç«¯å¤„ç† Roots å˜åŒ–

```java
@Bean
public BiConsumer<McpSyncServerExchange, List<McpSchema.Root>> 
        rootsChangeHandler() {
    return (exchange, roots) -> {
        roots.forEach(root -> {
            String uri = root.uri();
            String description = root.description();
            System.out.println("Rootèµ„æºå˜åŒ–: " + uri + " - " + description);
            
            // å¯ä»¥åœ¨è¿™é‡Œç›‘å¬èµ„æºå˜åŒ–ï¼Œä¾‹å¦‚æ–‡ä»¶ç³»ç»Ÿç›‘æ§
            // å½“èµ„æºå‘ç”Ÿå˜åŒ–æ—¶ï¼Œé€šè¿‡æ—¥å¿—é€šçŸ¥å®¢æˆ·ç«¯
            McpSchema.LoggingMessageNotification notification = 
                McpSchema.LoggingMessageNotification.builder()
                    .data("èµ„æºå‘ç”Ÿäº†å˜åŒ–: " + uri)
                    .level(McpSchema.LoggingLevel.INFO)
                    .logger("rootsChangeHandler")
                    .build();
            exchange.loggingNotification(notification);
        });
    };
}
```

## 5. Samplingï¼ˆé‡‡æ ·ï¼‰

Sampling å…è®¸æœåŠ¡å™¨åœ¨æ‰§è¡Œå·¥å…·å‰åé€šè¿‡å®¢æˆ·ç«¯å‘ LLM å‘èµ·å®Œæˆè¯·æ±‚ï¼Œå®ç°å¤æ‚çš„æ™ºèƒ½è¡Œä¸ºã€‚è¿™ç±»ä¼¼äºå›è°ƒå‡½æ•°ï¼Œå¯ä»¥åœ¨å·¥å…·æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸ LLM è¿›è¡Œäº¤äº’ã€‚

### 5.1 å®¢æˆ·ç«¯é…ç½® Sampling

```java
@Component
public static class CustomMcpSyncClientCustomizer 
        implements McpSyncClientCustomizer {
    
    @Override
    public void customize(String serverConfigurationName, 
                          McpClient.SyncSpec spec) {
        
        // å¯ç”¨ Sampling èƒ½åŠ›
        McpSchema.ClientCapabilities clientCapabilities = 
            McpSchema.ClientCapabilities.builder()
                .experimental(Map.of())
                .roots(true)
                .sampling()  // å¯ç”¨ Sampling
                .build();
        spec.capabilities(clientCapabilities);
        
        // è®¾ç½® Sampling å¤„ç†å™¨
        spec.sampling((McpSchema.CreateMessageRequest messageRequest) -> {
            List<McpSchema.SamplingMessage> messages = 
                messageRequest.messages();
            
            McpSchema.CreateMessageResult messageResult = null;
            for (McpSchema.SamplingMessage message : messages) {
                McpSchema.Content content = message.content();
                if ("text".equals(content.type())) {
                    McpSchema.TextContent textContent = 
                        (McpSchema.TextContent) content;
                    System.out.println("æ”¶åˆ°æœåŠ¡ç«¯çš„å›è°ƒ: " + textContent.text());
                    
                    // è¿”å›ç¡®è®¤æ¶ˆæ¯
                    messageResult = McpSchema.CreateMessageResult.builder()
                        .message("æˆ‘ç¡®è®¤ï¼š" + textContent.text())
                        .build();
                }
            }
            return messageResult;
        });
    }
}
```

### 5.2 æœåŠ¡ç«¯è°ƒç”¨ Sampling

åœ¨å·¥å…·æ–¹æ³•ä¸­ï¼Œå¯ä»¥é€šè¿‡ `ToolContext` è°ƒç”¨å®¢æˆ·ç«¯çš„ Samplingï¼š

```java
@Service
public class WeatherService {
    
    @Tool(description = "å¤©æ°”æŸ¥è¯¢")
    public String queryWeather(String city, ToolContext toolContext) {
        // åœ¨æ‰§è¡ŒæŸ¥è¯¢å‰ï¼Œå…ˆé€šè¿‡ Sampling ç¡®è®¤
        String confirmation = callMcpSampling(toolContext, city);
        System.out.println("å›è°ƒå‡½æ•°ç¡®è®¤: " + confirmation);
        
        return city + "çš„å¤©æ°”æ˜¯18Â°";
    }
    
    private String callMcpSampling(ToolContext toolContext, String city) {
        StringBuilder stringBuilder = new StringBuilder();
        
        McpToolUtils.getMcpExchange(toolContext)
            .ifPresent(exchange -> {
                // æ£€æŸ¥å®¢æˆ·ç«¯æ˜¯å¦æ”¯æŒ Sampling
                if (exchange.getClientCapabilities().sampling() != null) {
                    // åˆ›å»º Sampling è¯·æ±‚
                    McpSchema.CreateMessageRequest messageRequest = 
                        McpSchema.CreateMessageRequest.builder()
                            .messages(List.of(
                                new McpSchema.SamplingMessage(
                                    McpSchema.Role.USER,
                                    new McpSchema.TextContent(
                                        "ä½ ç¡®å®šè¦æŸ¥è¯¢: " + city
                                    )
                                )
                            ))
                            .build();
                    
                    // è°ƒç”¨å®¢æˆ·ç«¯çš„ Sampling
                    McpSchema.CreateMessageResult result = 
                        exchange.createMessage(messageRequest);
                    
                    if (result != null && result.content() != null) {
                        stringBuilder.append(result.content().text());
                    }
                }
            });
        
        return stringBuilder.toString();
    }
}
```

## 6. é€šè®¯æ–¹å¼è¯¦è§£

### 6.1 stdioï¼ˆæ ‡å‡†è¾“å…¥è¾“å‡ºï¼‰

stdio æ˜¯æœ€å¸¸ç”¨çš„é€šè®¯æ–¹å¼ï¼Œé€‚åˆæœ¬åœ°è¿›ç¨‹é—´é€šä¿¡ã€‚

#### æœåŠ¡ç«¯é…ç½®

```yml
spring:  
  ai:  
    mcp:  
      server:  
        name: stdio-mcp-server  
        version: 1.0.0  
        type: SYNC  
        stdio: true
```

#### å®¢æˆ·ç«¯é…ç½®

```yml
spring:  
  ai:  
    mcp:  
      client:  
        stdio:  
          connections:  
            server1:  
              command: java  
              args:  
                - -jar  
                - mcp-server.jar
            server2:  
              command: npx  
              args:  
                - -y  
                - "@modelcontextprotocol/server-filesystem"  
                - /Users/user/projects/
```

### 6.2 SSEï¼ˆServer-Sent Eventsï¼‰

SSE é€‚åˆ HTTP é•¿è¿æ¥åœºæ™¯ï¼Œæ”¯æŒæœåŠ¡ç«¯ä¸»åŠ¨æ¨é€æ¶ˆæ¯ã€‚

#### æœåŠ¡ç«¯ä¾èµ–

```xml
<dependency> 
    <groupId>org.springframework.ai</groupId> 
    <artifactId>spring-ai-starter-mcp-server-webmvc</artifactId> 
</dependency>
```

#### æœåŠ¡ç«¯é…ç½®

```yml
spring:  
  ai:  
    mcp:  
      server:  
        name: sse-mcp-server  
        version: 1.0.0  
        sse-endpoint: /sse  
        sse-message-endpoint: /mcp/message
```

#### å®¢æˆ·ç«¯é…ç½®

```yml
spring:  
  ai:  
    mcp:  
      client:  
        sse:  
          connections:  
            server1: http://localhost:8080
```

### 6.3 WebFluxï¼ˆå“åº”å¼ï¼‰

WebFlux æ”¯æŒå“åº”å¼ç¼–ç¨‹ï¼Œé€‚åˆé«˜å¹¶å‘å¼‚æ­¥åœºæ™¯ã€‚

#### æœåŠ¡ç«¯ä¾èµ–

```xml
<dependency> 
    <groupId>org.springframework.ai</groupId> 
    <artifactId>spring-ai-starter-mcp-server-webflux</artifactId> 
</dependency>
```

#### å®¢æˆ·ç«¯ä¾èµ–

```xml
<dependency>  
    <groupId>org.springframework.ai</groupId>  
    <artifactId>spring-ai-starter-mcp-client-webflux</artifactId>  
</dependency>
```

é…ç½®æ–¹å¼ä¸ SSE ç±»ä¼¼ï¼Œåº•å±‚ä½¿ç”¨å“åº”å¼ç¼–ç¨‹æ¨¡å‹ã€‚

## 7. ç›‘å¬å™¨ï¼ˆChange Consumersï¼‰

MCP æä¾›äº†å¤šç§ç›‘å¬å™¨ï¼Œç”¨äºç›‘å¬å·¥å…·ã€èµ„æºã€æç¤ºè¯ç­‰çš„å˜åŒ–ã€‚

### 7.1 é…ç½®ç›‘å¬å™¨

```java
@Component
public static class CustomMcpSyncClientCustomizer 
        implements McpSyncClientCustomizer {
    
    @Override
    public void customize(String serverConfigurationName, 
                          McpClient.SyncSpec spec) {
        
        // ç›‘å¬å·¥å…·å˜åŒ–
        spec.toolsChangeConsumer((List<McpSchema.Tool> tools) -> {
            System.out.println("å·¥å…·åˆ—è¡¨å·²æ›´æ–°ï¼Œå…± " + tools.size() + " ä¸ªå·¥å…·");
            tools.forEach(tool -> 
                System.out.println("  - " + tool.name() + ": " + tool.description())
            );
        });
        
        // ç›‘å¬èµ„æºå˜åŒ–
        spec.resourcesChangeConsumer((List<McpSchema.Resource> resources) -> {
            System.out.println("èµ„æºåˆ—è¡¨å·²æ›´æ–°ï¼Œå…± " + resources.size() + " ä¸ªèµ„æº");
            resources.forEach(resource -> 
                System.out.println("  - " + resource.name() + ": " + resource.description())
            );
        });
        
        // ç›‘å¬æç¤ºè¯å˜åŒ–
        spec.promptsChangeConsumer((List<McpSchema.Prompt> prompts) -> {
            System.out.println("æç¤ºè¯åˆ—è¡¨å·²æ›´æ–°ï¼Œå…± " + prompts.size() + " ä¸ªæç¤ºè¯");
            prompts.forEach(prompt -> 
                System.out.println("  - " + prompt.name() + ": " + prompt.description())
            );
        });
        
        // ç›‘å¬æ—¥å¿—æ¶ˆæ¯
        spec.loggingConsumer((McpSchema.LoggingMessageNotification log) -> {
            System.out.println("[" + log.level() + "] " + 
                log.logger() + ": " + log.data());
        });
    }
}
```

### 7.2 è‡ªå®šä¹‰è¶…æ—¶é…ç½®

```java
@Component
public static class CustomMcpSyncClientCustomizer 
        implements McpSyncClientCustomizer {
    
    @Override
    public void customize(String serverConfigurationName, 
                          McpClient.SyncSpec spec) {
        
        // è®¾ç½®è¯·æ±‚è¶…æ—¶æ—¶é—´
        spec.requestTimeout(Duration.ofSeconds(30));
    }
}
```

## 8. æœ€ä½³å®è·µ

### 8.1 å·¥å…·è®¾è®¡åŸåˆ™

1. **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªå·¥å…·åº”è¯¥åªåšä¸€ä»¶äº‹
2. **æ¸…æ™°çš„æè¿°**ï¼šå·¥å…·æè¿°åº”è¯¥æ¸…æ™°è¯´æ˜åŠŸèƒ½å’Œå‚æ•°
3. **é”™è¯¯å¤„ç†**ï¼šå·¥å…·åº”è¯¥å¦¥å–„å¤„ç†å¼‚å¸¸æƒ…å†µ
4. **å¹‚ç­‰æ€§**ï¼šå·¥å…·è°ƒç”¨åº”è¯¥æ˜¯å¹‚ç­‰çš„ï¼Œé‡å¤è°ƒç”¨ä¸åº”è¯¥äº§ç”Ÿå‰¯ä½œç”¨

### 8.2 èµ„æºè®¾è®¡åŸåˆ™

1. **RESTful é£æ ¼**ï¼šèµ„æº URI åº”è¯¥éµå¾ª RESTful è®¾è®¡åŸåˆ™
2. **ç¼“å­˜ç­–ç•¥**ï¼šè€ƒè™‘èµ„æºçš„ç¼“å­˜éœ€æ±‚
3. **æ•°æ®æ ¼å¼**ï¼šä½¿ç”¨æ ‡å‡†çš„æ•°æ®æ ¼å¼ï¼ˆJSONã€XML ç­‰ï¼‰

### 8.3 æ€§èƒ½ä¼˜åŒ–

1. **å¼‚æ­¥å¤„ç†**ï¼šå¯¹äºè€—æ—¶æ“ä½œï¼Œä½¿ç”¨å¼‚æ­¥å·¥å…·å›è°ƒ
2. **æ‰¹é‡æ“ä½œ**ï¼šå°½é‡æ”¯æŒæ‰¹é‡æ“ä½œï¼Œå‡å°‘ç½‘ç»œå¾€è¿”
3. **è¿æ¥æ± **ï¼šåˆç†é…ç½®è¿æ¥æ± å¤§å°

### 8.4 å®‰å…¨æ€§è€ƒè™‘

1. **è¾“å…¥éªŒè¯**ï¼šå§‹ç»ˆéªŒè¯å®¢æˆ·ç«¯è¾“å…¥
2. **æƒé™æ§åˆ¶**ï¼šå®ç°é€‚å½“çš„æƒé™æ§åˆ¶æœºåˆ¶
3. **æ•æ„Ÿæ•°æ®**ï¼šé¿å…åœ¨æ—¥å¿—ä¸­è¾“å‡ºæ•æ„Ÿä¿¡æ¯

## 9. æ€»ç»“

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº† MCP çš„é«˜çº§åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š

- **Tools**ï¼šå¦‚ä½•å®šä¹‰å’Œä½¿ç”¨å·¥å…·
- **Resources**ï¼šå¦‚ä½•æš´éœ²å’Œè¯»å–èµ„æº
- **Prompts**ï¼šå¦‚ä½•å®šä¹‰å¯å¤ç”¨çš„æç¤ºè¯
- **Roots**ï¼šå¦‚ä½•ç®¡ç†æ ¹èµ„æº
- **Sampling**ï¼šå¦‚ä½•å®ç°æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯çš„äº¤äº’
- **é€šè®¯æ–¹å¼**ï¼šstdioã€SSEã€WebFlux çš„é…ç½®å’Œä½¿ç”¨
- **ç›‘å¬å™¨**ï¼šå¦‚ä½•ç›‘å¬å„ç§å˜åŒ–äº‹ä»¶

é€šè¿‡åˆç†ä½¿ç”¨è¿™äº›åŠŸèƒ½ï¼Œæ‚¨å¯ä»¥æ„å»ºå¼ºå¤§è€Œçµæ´»çš„ MCP åº”ç”¨ã€‚

> ğŸ“– **ç›¸å…³æ–‡æ¡£**ï¼š
> - [MCP æ˜¯æœ€ä¼˜è§£å—ï¼Ÿ](./2.mcp-not-best.md) - äº†è§£ MCP çš„é€‚ç”¨åœºæ™¯
> - [MCP çš„å±€é™æ€§ä¸å®‰å…¨æ€§](./3.mcp-problems.md) - äº†è§£ MCP çš„é™åˆ¶å’Œå®‰å…¨æ³¨æ„äº‹é¡¹
