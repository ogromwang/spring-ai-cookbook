# 提示词管理

在实际应用中，我们经常需要复用提示词模板，而不是每次都硬编码提示词内容。Spring AI 提供了强大的提示词管理功能，支持模板变量替换和多种消息类型。

## 基本用法

[PromptExampleTest](https://github.com/dong4j/spring-ai-cookbook/blob/main/1.spring-ai-started/src/test/java/dev/dong4j/ai/spring/chatclient/PromptExampleTest.java)

::: code-group

```java [java:简单提示词]
@Service
public class PromptExample {

    private final ChatClient chatClient;

    public PromptExample(ChatClient.Builder chatClientBuilder) {
        this.chatClient = chatClientBuilder.build();
    }

    public String simplePrompt(String userMessage) {
        return chatClient.prompt(userMessage).call().content();
    }
}
```

```java [java:使用 System 提示词]
public String promptWithSystem(String userMessage) {
    return chatClient
        .prompt()
        .system("你是一个专业的 Java 开发工程师，擅长 Spring 框架。请用一句话回答问题。")
        .user(userMessage)
        .call()
        .content();
}
```

```java [java:提示词模板]
public String promptWithTemplate(String language, String topic) {
    return chatClient
        .prompt()
        .user(u -> u
            .text("用 {language} 一句话解释 {topic}")
            .param("language", language)
            .param("topic", topic))
        .call()
        .content();
}
```

```java [java:复杂模板]
public String complexTemplate(String product, String targetAudience, String feature) {
    return chatClient
        .prompt()
        .user(u -> u
            .text("用一句话介绍 {product}，面向 {targetAudience}，突出 {feature}")
            .param("product", product)
            .param("targetAudience", targetAudience)
            .param("feature", feature))
        .call()
        .content();
}
```

```java [java:测试用例]
@SpringBootTest
class PromptExampleTest {

    @Autowired
    private PromptExample promptExample;

    @Test
    void testSimplePrompt() {
        String response = promptExample.simplePrompt("用一句话介绍 Spring AI");
        assertThat(response).isNotNull();
        System.out.println("简单提示词 - AI 回复: " + response);
    }

    @Test
    void testPromptWithSystem() {
        String response = promptExample.promptWithSystem("Spring AI 是什么?");
        assertThat(response).contains("Spring");
        System.out.println("系统提示词 - AI 回复: " + response);
    }

    @Test
    void testPromptWithTemplate() {
        String response = promptExample.promptWithTemplate("中文", "ChatClient");
        assertThat(response).isNotEmpty();
        System.out.println("提示词模板 - AI 回复: " + response);
    }

    @Test
    void testComplexTemplate() {
        String response = promptExample.complexTemplate("ChatClient", "开发者", "简单易用");
        assertThat(response).isNotEmpty();
        System.out.println("复杂模板 - AI 回复: " + response);
    }
}
```

:::

## 提示词模板语法

Spring AI 默认使用 [StringTemplate](https://www.stringtemplate.org/) 引擎处理模板，变量使用 `{变量名}` 语法：

```java
public String complexTemplate(String product, String targetAudience, String feature) {
    return chatClient
        .prompt()
        .user(u -> u
            .text("用一句话介绍 {product}，面向 {targetAudience}，突出 {feature}")
            .param("product", product)
            .param("targetAudience", targetAudience)
            .param("feature", feature))
        .call()
        .content();
}
```

## 自定义模板分隔符

如果提示词中包含 JSON 或其他使用 `{}` 的内容，可以自定义模板分隔符：

```java
ChatClient client = ChatClient.builder(chatModel)
    .defaultSystemPrompt("你是一个专业的代码审查助手")
    .build();

String reply = client.prompt()
    .user(u -> u
        .text("请审查以下代码：<code>")
        .param("code", "public class Test { }"))
    .templateRenderer(StTemplateRenderer.builder()
        .startDelimiterToken('<')
        .endDelimiterToken('>')
        .build())
    .call()
    .content();
```

## 参考文档

- [Spring AI ChatClient 官方文档](https://docs.spring.io/spring-ai/reference/api/chatclient.html)
- [[stringtemplate-introduction|StringTemplate 引擎]]

## 继续深入

- [[3.spring-ai-prompts/index|提示词管理]]

---
